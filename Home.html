
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
<link rel="icon" href="favicon.ico" type="image/ico">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
body { font-family:"Cairo",sans-serif; margin:0; background:#f3f4f6; color:#333; direction:rtl; transition:.3s;}
body.dark{background:#111827;color:#e5e7eb;}
header{background:linear-gradient(135deg,#4f46e5,#6366f1);color:white;padding:25px 20px;font-size:22px;font-weight:bold;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
.toggle-btn{background:white;color:#4f46e5;border:none;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:14px;margin-top:5px;}
body.dark .toggle-btn{background:#1f2937;color:#f3f4f6;}
main{max-width:900px;margin:30px auto;padding:0 15px;}
.controls{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
input,button{padding:10px 15px;border-radius:8px;border:none;font-size:14px;}
input{flex:1;border:1px solid #ddd;}
button{cursor:pointer;background:#4f46e5;color:white;transition:.2s;}
button:hover{background:#3730a3;}
button:disabled{background:#ccc;cursor:not-allowed;}
.subject-card{background:white;border-radius:12px;padding:20px;margin-bottom:15px;box-shadow:0 4px 12px rgba(0,0,0,0.1);transition:.3s;}
body.dark .subject-card{background:#1f2937;color:#f9fafb;}
.subject-card h3{margin:0 0 10px;}
.actions{display:flex;gap:8px;flex-wrap:wrap;}
.actions button{flex:1;min-width:120px;}
.file-label{display:inline-block;padding:10px 15px;background:#6366f1;color:white;border-radius:8px;cursor:pointer;font-size:14px;transition:.2s;}
.file-label:hover{background:#4f46e5;}
input[type="file"]{display:none;}
.download-all{margin:20px 0;text-align:center;}
.progress-bar{height:8px;width:0%;background:#4f46e5;border-radius:4px;transition:width .3s;}
.preview-container{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;}
.preview-container img{max-width:100px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);cursor:move;}
.preview-container img.dragging{opacity:.5;}
footer{text-align:center;padding:15px;color:#0e7653;font-family:Arial,sans-serif;font-size:14px;margin-top:50px;}
.link-btn a{display:inline-block;background:linear-gradient(135deg,#4f46e5,#6366f1);color:white;padding:5px 5px;border-radius:10px;text-decoration:none;font-size:16px;font-weight:bold;transition:.3s;}
.link-btn a:hover{background:linear-gradient(135deg,#3730a3,#4f46e5);}
@media(max-width:600px){.actions{flex-direction:column}.actions button{min-width:100%}.controls{flex-direction:column} input,button{width:100%}.preview-container img{max-width:80px}}
</style>
</head>
<body>
<header>
<span>ğŸ“š Ù…ÙƒØªØ¨ØªÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</span>
<div class="link-btn">
  <a href="https://ah9742824-oss.github.io/my-project/" target="_blank" title="Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹">ğŸŒ</a>
</div>
<button class="toggle-btn" onclick="toggleDarkMode()">ğŸŒ™/â˜€ï¸</button>
</header>

<main>
<div class="controls">
<input type="text" id="subjectName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©...">
<button onclick="addSubject()">â• Ø¥Ø¶Ø§ÙØ©</button>
</div>
<div id="subjects"></div>
</main>

<footer>
Designed & Developed by: Ahmed Hany Sayed Ahmed Abdel Wahab &copy; 2025
</footer>

<script>
const { jsPDF } = window.jspdf;
let subjects = JSON.parse(localStorage.getItem("subjects")||"[]");

function showToast(msg,type="info"){Toastify({text:msg,duration:3000,gravity:"top",position:"center",backgroundColor:type==="error"?"#dc2626":"#4f46e5"}).showToast();}
function saveSubjects(){localStorage.setItem("subjects",JSON.stringify(subjects));}
function toggleDarkMode(){document.body.classList.toggle("dark");}

function addSubject(){
  const name=document.getElementById("subjectName").value.trim();
  if(!name){showToast("âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©","error");return;}
  subjects.push({name,images:[],pdf:null});
  saveSubjects(); renderSubjects();
  document.getElementById("subjectName").value="";
  showToast("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø©");
}

function deleteSubject(i){if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")){subjects.splice(i,1);saveSubjects();renderSubjects();showToast("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù");}}
function editSubject(i){const n=prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:",subjects[i].name);if(n){subjects[i].name=n;saveSubjects();renderSubjects();showToast("âœï¸ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…");}}

function renderSubjects(){
  const container=document.getElementById("subjects"); container.innerHTML="";
  subjects.forEach((subj,i)=>{
    const div=document.createElement("div"); div.className="subject-card";
    div.innerHTML=`
<h3>${subj.name}</h3>
<label class="file-label" for="fileInput-${i}">ğŸ“‚ Ø§Ø®ØªØ± ØµÙˆØ±</label>
<input type="file" id="fileInput-${i}" multiple>
<p id="fileCount-${i}" style="margin:8px 0;color:#666;font-size:14px;">${subj.images.length?"ğŸ–¼ï¸ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±: "+subj.images.length:"ğŸ–¼ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ± Ø¨Ø¹Ø¯"}</p>
<div class="preview-container" id="preview-${i}"></div>
<p id="progress-${i}" style="margin:8px 0;color:#555;font-size:14px;"></p>
<div class="progress-bar" id="bar-${i}"></div>
<div class="actions">
<button id="convertBtn-${i}" onclick="convertToPDF(${i})">ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡/ØªØ­Ø¯ÙŠØ« PDF</button>
<button id="previewBtn-${i}" onclick="previewPDF(${i})" ${!subj.pdf?'disabled':''}>ğŸ‘€ Ù…Ø¹Ø§ÙŠÙ†Ø© PDF</button>
<button id="downloadBtn-${i}" onclick="downloadPDF(${i})" ${!subj.pdf?'disabled':''}>â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ PDF</button>
<button onclick="editSubject(${i})">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù…</button>
<button onclick="deleteSubject(${i})" style="background:#dc2626">ğŸ—‘ï¸ Ø­Ø°Ù</button>
</div>`; container.appendChild(div);

    const input=document.getElementById(`fileInput-${i}`);
    const preview=document.getElementById(`preview-${i}`);
    const fileCount=document.getElementById(`fileCount-${i}`);
    subj.images=subj.images||[];

    preview.innerHTML=""; subj.images.forEach(im=>{const img=document.createElement("img");img.src=im.url;preview.appendChild(img);});
    new Sortable(preview,{animation:150,ghostClass:'dragging',onEnd:function(){const order=Array.from(preview.children).map(img=>subj.images.find(im=>im.url===img.src)); subj.images=order; saveSubjects();}});

    input.addEventListener("change",()=>{
      const files=Array.from(input.files);
      subj.images=files.map(f=>({file:f,url:URL.createObjectURL(f)}));
      fileCount.textContent=files.length?"ğŸ–¼ï¸ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±: "+files.length:"ğŸ–¼ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ± Ø¨Ø¹Ø¯";
      preview.innerHTML=""; subj.images.forEach(im=>{const img=document.createElement("img");img.src=im.url;preview.appendChild(img);});
      saveSubjects();
    });
  });
}

async function convertToPDF(i){
  const subj=subjects[i];
  if(!subj.images.length){showToast("ğŸ“Œ Ø§Ø®ØªØ± ØµÙˆØ± Ø£ÙˆÙ„Ø§Ù‹","error"); return;}
  const pdf=new jsPDF("p","mm","a4");
  const progress=document.getElementById(`progress-${i}`);
  const bar=document.getElementById(`bar-${i}`);
  bar.style.width="0%"; bar.style.background="#b6f4d9"; progress.textContent="â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...";

  for(let j=0;j<subj.images.length;j++){
    await new Promise(resolve=>{
      const reader=new FileReader();
      reader.onload=e=>{
        const img=new Image();
        img.onload=()=>{
          const w=190,h=277; const ratio=Math.min(w/img.width,h/img.height,1);
          const width=img.width*ratio,height=img.height*ratio;
          const canvas=document.createElement("canvas"); canvas.width=width; canvas.height=height;
          canvas.getContext("2d").drawImage(img,0,0,width,height);
          const dataURL=canvas.toDataURL("image/jpeg",0.7);
          if(j>0) pdf.addPage();
          pdf.addImage(dataURL,"JPEG",(210-width)/2,(297-height)/2,width,height);
          bar.style.width=Math.round(((j+1)/subj.images.length)*100)+"%";
          progress.textContent=`ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„... ${Math.round(((j+1)/subj.images.length)*100)}%`;
          resolve();
        }; img.src=e.target.result;
      }; reader.readAsDataURL(subj.images[j].file);
    });
  }

  const blob=pdf.output("blob"); subj.pdf=URL.createObjectURL(blob); saveSubjects();
  document.getElementById(`previewBtn-${i}`).disabled=false;
  document.getElementById(`downloadBtn-${i}`).disabled=false;
  bar.style.width="100%"; bar.style.background="#1ae37f";
  progress.textContent=`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PDF`;
}

function previewPDF(i){const subj=subjects[i]; if(subj.pdf) window.open(subj.pdf,"_blank");}
function downloadPDF(i){const subj=subjects[i]; if(subj.pdf){const a=document.createElement("a");a.href=subj.pdf;a.download=`${subj.name}.pdf`;a.click();}}

renderSubjects();
</script>
</body>
</html>

