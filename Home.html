
<!DOCTYPE html>
<html lang="ar">
<head> 
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>📚 مكتبتي التعليمية</title>
  <link rel="icon" href="favicon.ico" type="image/ico">

  <!-- مكتبات -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <style>
    body {
      font-family: "Cairo", sans-serif;
      margin: 0;
      background: #f3f4f6;
      color: #333;
      direction: rtl;
      transition: 0.3s;
    }
    body.dark {
      background: #111827;
      color: #e5e7eb;
    }
    header {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: white;
      padding: 25px 20px;
      font-size: 22px;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .toggle-btn {
      background: white;
      color: #4f46e5;
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 14px;
    }
    body.dark .toggle-btn {
      background: #1f2937;
      color: #f3f4f6;
    }
    main {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 15px;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    input, button {
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }
    input {
      flex: 1;
      border: 1px solid #ddd;
    }
    button {
      cursor: pointer;
      background: #4f46e5;
      color: white;
      transition: 0.2s;
    }
    button:hover {
      background: #3730a3;
    }
    .subject-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: 0.3s;
    }
    body.dark .subject-card {
      background: #1f2937;
      color: #f9fafb;
    }
    .subject-card h3 {
      margin: 0 0 10px;
    }
    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .actions button {
      flex: 1;
    }
    .file-label {
      display: inline-block;
      padding: 10px 15px;
      background: #6366f1;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.2s;
    }
    .file-label:hover {
      background: #4f46e5;
    }
    input[type="file"] {
      display: none;
    }
    .download-all {
      margin: 20px 0;
      text-align: center;
    }
    .link-btn {
      text-align: center;
    }
    .link-btn a {
      display: inline-block;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: white;
      padding: 5px 5px;
      border-radius: 10px;
      text-decoration: none;
      font-size: 16px;
      font-weight: bold;
      transition: 0.3s;
    }
    .link-btn a:hover {
      background: linear-gradient(135deg, #3730a3, #4f46e5);
    }
    .progress-bar {
      height: 8px;
      width: 0%;
      background: #4f46e5;
      border-radius: 4px;
      transition: width 0.3s;
    }




    
    footer {
  text-align: center;       /* يجعل النص في المنتصف أفقيًا */
  padding: 15px;            /* مسافة من الحواف */
  background-color: #f2f2f2; /* لون خلفية الفوتر */
  color: #333;              /* لون الخط */
  font-family: Arial, sans-serif;
  font-size: 14px;
}



    
  </style>
</head>

<body>
  <header>
    <span>📚 مكتبتي التعليمية</span>
    <div class="link-btn">
      <a href="https://ah9742824-oss.github.io/my-project/" target="_blank">🌐</a>
    </div>
    <button class="toggle-btn" onclick="toggleDarkMode()">🌙/☀️</button>
  </header>

  <main>
    <div class="controls">
      <input type="text" id="subjectName" placeholder="اسم المادة...">
      <button onclick="addSubject()">➕ إضافة</button>
    </div>
    <div id="subjects"></div>
    <div class="download-all">
      <button onclick="downloadAll()">⬇️ تحميل كل الملفات ZIP</button>
    </div>
  </main>

  <script>
    const { jsPDF } = window.jspdf;
    let subjects = JSON.parse(localStorage.getItem("subjects") || "[]");

    function saveSubjects() {
      localStorage.setItem("subjects", JSON.stringify(subjects));
    }

    function renderSubjects() {
      const container = document.getElementById("subjects");
      container.innerHTML = "";
      subjects.forEach((subj, i) => {
        const div = document.createElement("div");
        div.className = "subject-card";
        div.innerHTML = `
          <h3>${subj.name}</h3>
          <label class="file-label" for="fileInput-${i}">📂 اختر صور</label>
          <input type="file" id="fileInput-${i}" multiple accept="image/*">
          <p id="fileCount-${i}" style="margin:8px 0;color:#666;font-size:14px;">🖼️ لم يتم اختيار صور بعد</p>
          <p id="progress-${i}" style="margin:8px 0;color:#555;font-size:14px;"></p>
          <div class="progress-bar" id="bar-${i}"></div>
          <div class="actions">
            <button onclick="convertToPDF(${i})">📄 إنشاء/تحديث PDF</button>
            <button onclick="openPDF(${i})">📖 عرض الملف</button>
            <button onclick="downloadPDF(${i})">⬇️ تحميل الملف</button>
            <button onclick="editSubject(${i})">✏️ تعديل اسم</button>
            <button onclick="deleteSubject(${i})" style="background:#dc2626">🗑️ حذف</button>
          </div>
        `;
        container.appendChild(div);

        // عدّاد الصور
        const fileInput = document.getElementById(`fileInput-${i}`);
        const fileCount = document.getElementById(`fileCount-${i}`);
        fileInput.addEventListener("change", () => {
          const count = fileInput.files.length;
          fileCount.textContent = count
            ? `🖼️ عدد الصور: ${count}`
            : "🖼️ لم يتم اختيار صور بعد";
        });
      });
    }

    function addSubject() {
      const name = document.getElementById("subjectName").value.trim();
      if (!name) return alert("⚠️ اكتب اسم المادة");
      subjects.push({ name, pdf: null, pdfName: null });
      saveSubjects();
      renderSubjects();
      document.getElementById("subjectName").value = "";
    }

    function deleteSubject(i) {
      if (confirm("هل انت متأكد من الحذف؟")) {
        subjects.splice(i, 1);
        saveSubjects();
        renderSubjects();
      }
    }

    function editSubject(i) {
      const newName = prompt("اكتب الاسم الجديد:", subjects[i].name);
      if (newName) {
        subjects[i].name = newName;
        saveSubjects();
        renderSubjects();
      }
    }

    // تحويل الصور إلى PDF مع شريط تحميل
    window.convertToPDF = (index) => {
      const input = document.getElementById(`fileInput-${index}`);
      const progressText = document.getElementById(`progress-${index}`);
      const bar = document.getElementById(`bar-${index}`);

      if (!input.files.length && !subjects[index].pdf)
        return alert("📌 اختار صور الأول");

      const pdf = new jsPDF("p", "mm", "a4");
      let files = input.files.length ? Array.from(input.files) : [];

      let count = 0;
      const total = files.length;

      progressText.textContent = "⏳ جاري التحويل...";
      bar.style.width = "0%";
      bar.style.background = "#4f46e5";

      files.forEach((file, i) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            const imgWidth = 210;
            const imgHeight = (img.height * imgWidth) / img.width;
            if (i > 0) pdf.addPage();
            pdf.addImage(img, "JPEG", 0, 0, imgWidth, imgHeight);

            count++;
            const progress = Math.round((count / total) * 100);
            bar.style.width = progress + "%";
            progressText.textContent = `🔄 جاري التحويل... ${progress}%`;

            if (count === total) {
              const pdfName = `${subjects[index].name}.pdf`;
              const pdfBlob = pdf.output("blob");
              const pdfUrl = URL.createObjectURL(pdfBlob);
              subjects[index].pdf = pdfUrl;
              subjects[index].pdfName = pdfName;
              saveSubjects();

              setTimeout(() => {
                bar.style.background = "#b6f4d9";
                progressText.textContent = `✅ تم إنشاء الملف (${pdfName}) بنجاح`;
                bar.style.width = "100%";
              }, 400);
            }
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    };

    window.openPDF = (index) => {
      if (!subjects[index].pdf) return alert("📌 مفيش ملف محفوظ");
      window.open(subjects[index].pdf, "_blank");
    };

    window.downloadPDF = (index) => {
      if (!subjects[index].pdf) return alert("📌 مفيش ملف محفوظ");
      const link = document.createElement("a");
      link.href = subjects[index].pdf;
      link.download = subjects[index].pdfName;
      link.click();
    };

    function downloadAll() {
      const zip = new JSZip();
      let count = 0;
      const total = subjects.filter(s => s.pdf).length;

      if (total === 0) return alert("📌 مفيش ملفات محفوظة للتحميل");

      subjects.forEach(subj => {
        if (subj.pdf) {
          fetch(subj.pdf).then(res => res.blob()).then(blob => {
            zip.file(subj.pdfName, blob);
            count++;
            if (count === total) {
              zip.generateAsync({ type: "blob" }).then(content => {
                saveAs(content, "كل_الملفات.zip");
              });
            }
          });
        }
      });
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    renderSubjects();

    window.addEventListener("beforeunload", function (e) {
      e.preventDefault();
      e.returnValue = "⚠️ انت على وشك الخروج، هل متأكد انك عايز تقفل؟";
    });
  </script>
  
<footer>
Designed & Developed by : Ahmed Hany Sayed Ahmed Abdel Wahab 
&copy; 2025
</footer>
  
</body>
</html>

